name: Trigger Petrox email job

on:
  schedule:
    - cron: '0 9 * * *'   # daily at 09:00 UTC â€” change as needed
  workflow_dispatch:      # allows manual run from GitHub UI

jobs:
  trigger-render-job:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Render one-off job
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
        run: |
          SERVICE_ID="srv-xxxxxxxxxxxx"   # <-- replace with your service id
          START_CMD='python manage.py send_emailmessage --id 123 --batch-size 50 --pause 1 --timeout 15'
          echo "Creating Render one-off job for service $SERVICE_ID"
          curl -s -X POST "https://api.render.com/v1/services/${SERVICE_ID}/jobs" \
            -H "Authorization: Bearer ${RENDER_API_KEY}" \
            -H "Content-Type: application/json" \
            -d "{\"startCommand\": ${START_CMD@Q}}"
